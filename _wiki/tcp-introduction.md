---
layout: wiki
title: TCP连接原理介绍
cate1: 网络
cate2:
description: TCP连接原理介绍
keywords: tcp,原理
type:
link:
mermaid: false
sequence: true
flow: false
mathjax: false
mindmap: false
mindmap2: false
---


```sequence
客户端->服务器: 发送SYN请求
Note right of 服务器: 服务器准备\n接受连接，分配资源
服务器-->客户端: 发送SYN-ACK响应 (序列号 = x, 确认号 = y)
客户端->>服务器: 发送ACK确认 (确认号 = y+1)
Note right of 客户端: 连接已建立
```

## TCP握手过程

TCP三次握手是建立网络连接时双方之间进行的一系列步骤。以下是三次握手的详细过程：

1. **客户端发起连接请求：**
   - 客户端向服务器发送一个[SYN](#tcp数据包)（同步）请求，表明客户端希望建立连接。
   - 客户端选择一个初始序列号，通常用随机数生成，并发送给服务器。

2. **服务器准备接受连接：**
   - 服务器收到客户端的[SYN](#tcp数据包)请求后，准备接受连接，分配相应的资源（如缓存、控制块等）。
   - 服务器为该连接选择一个自己的初始序列号，并在确认号字段中回复客户端。

3. **服务器确认并建立连接：**
   - 服务器向客户端发送一个带有[SYN](#tcp数据包)和[ACK](#tcp数据包)标志的包，表示同意建立连接。同时，将确认号设置为客户端的初始序列号加一。
   - 客户端接收到服务器的响应后，也要发送一个带有[ACK](#tcp数据包)标志的包，确认收到了服务器的SYN。客户端的确认号被设置为服务器的初始序列号加一。
   - 至此，连接建立完成，双方可以开始进行数据传输。


这个过程的三次握手保证了双方都同意建立连接，并且双方都收到了对方的同意。如果其中一方在握手过程中出现问题，会导致连接建立失败，从而确保了可靠的通信。

## TCP数据包

当进行TCP三次握手时，SYN和ACK标志的包在通信中起着重要的作用。以下是关于这两种标志的包的内容的详细介绍：

1. **SYN标志（Synchronize）：**
   - 客户端发送的第一个包带有SYN标志，它表示客户端请求建立连接。
   - SYN包中包含一个序列号（Sequence Number），该序列号是客户端选择的一个初始值，用于后续的数据传输顺序标识。
   - SYN包不包含实际的数据，因为其主要目的是启动连接过程。

2. **ACK标志（Acknowledgment）：**
   - 服务器在接收到客户端的SYN后，会回复一个带有SYN和ACK标志的包，表示同意建立连接。
   - SYN-ACK包中包含两个重要的信息：
     - 序列号（Sequence Number）：服务器选择的一个初始值，用于标识服务器发送的数据包的顺序。
     - 确认号（Acknowledgment Number）：确认号被设置为客户端发送的序列号加一，表示服务器已经收到了客户端的SYN请求。

通过SYN和ACK标志的组合，双方在三次握手过程中达成一致，确保了双向通信的可靠性。客户端的ACK确认包在第三步发出，其中的确认号被设置为服务器的序列号加一，表示客户端已经收到了服务器的确认，并且连接已经建立。